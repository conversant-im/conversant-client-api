<!DOCTYPE html>
<html>
    <head>
        <title>Conversant API Demo</title>
    </head>
    <body>
        <div id="remotes">
            <h2>Demo App</h2>
            <div id="container">

            </div>
        </div>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
        <script src="bundle.js"></script>
        <script>
            var c = new conversant.ConversantAPI('917ed254-dd71-4f96-8e39-7870ae49e5b7');
            window.c = c;   // debug in console


            c.init(function(appInit){
                console.log(appInit);
                var app = appInit.app; // This is of type m.Apps.App
                var restoreState = appInit.restoreState;
                var profile = appInit.profile; // This is of type m.Auth.ProfileInfo
                var collaboration = appInit.collaboration; // This is of type m.Collaboration.Collaboration
                var team = appInit.team; // This is of type m.Collaboration.SyncUserEvent[]
                var peers = appInit.peers; // This is of type m.Peers.PeerState[]

                var mode = c.isSyncMode ? "In Sync Panel" : "In App Panel"
                console.log('restoreState', restoreState)

                function handleSync(viewSync){
                    var src = viewSync.resource.uri;
                    $('#container').html('<img src="'+src+'" />');   // sync the view for all users
                }

                if(c.isSyncMode){
                    $.each(restoreState,function(i, state){
                        handleSync(state);
                    });
                    c.addResponder(m.Collaboration.SyncViewEvent.type(),function(sync){
                        handleSync(sync.viewerState);
                    });
                }else{
                    var spaceCats = [
                            'https://pbs.twimg.com/media/ByZOMh8IUAE7cxj.jpg',
                            'http://i.imgur.com/GaAI9uH.jpg',
                            'http://i.imgur.com/PyKPjMh.jpg',
                            'http://i.imgur.com/qqDXC4c.jpg',
                            'http://i.imgur.com/2z39gDe.jpg',
                            'http://i.imgur.com/AizmOYh.jpg',
                    ];
                    $('#container').append('<h2>click to inject image</h2>');
                    $.each(spaceCats,function(i,src){
                        $('#container').append('<img src="'+src+'" />');
                    });
                    $('#container img').click(function(){
                        var src = $(this).attr('src');
                        var viewState = new m.Collaboration.ViewerState(app,new m.Resource.Resource( src,"image/jpg",src),0,{},m.Geom.Transform3d.identity());
                        console.log(viewState)
                        c.syncView(viewState);
                    });

                }
            });
	    console.log('win name:', window.name);
        </script>
    </body>
</html>
